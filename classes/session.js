(function(){var a,b;a=function(){this.sessionID=null,this.data=null,this._cookiePath=null},b=a,b.COOKIE_NAME="JSSESSID",b.MAX_TRY_COUNT=5,b.__sessionPath=".",b.__getCookie=null,b.__setCookie=null,b.__clearCookie=null,b.__init=function(a,c,d,e){b.__getCookie=a,b.__setCookie=c,b.__clearCookie=d,b.__sessionPath=e},b.prototype.getSession=function(){var a=b.__getCookie(b.COOKIE_NAME),c=require("fs"),d,e,f;if(a){this.sessionID=a,d=this._getSessionFileName();try{e=c.readFileSync(d),f=e?JSON.parse(e):null,this._cookiePath=f.cookiePath,this.data=f.data}catch(a){}}},b.prototype.start=function(a,c){this.destroy(true);var d,e=require("fs"),f,g,h={cookiePath:this._cookiePath,data:this.data},i=new Date,j={},k=true,l=0;while(k){d=b._generateId(),this.sessionID=d,f=this._getSessionFileName();try{g=e.statSync(f),l++;if(l>b.MAX_TRY_COUNT){require("sys").log("to much tryies to create session"),k=false;return false}}catch(a){k=false;break}}e.writeFile(f,JSON.stringify(h),function(a){}),a||(j.expires=new Date(i.getFullYear()+1,i.getMonth(),i.getDay())),c&&(j.path=c,this._cookiePath=c),b.__setCookie(b.COOKIE_NAME,d,j);return true},b.prototype.destroy=function(a){if(!this.sessionID)return;var c=require("fs"),d=this._getSessionFileName();try{c.unlink(d)}catch(a){}this.sessionID=null,this.data=null,a||b.__clearCookie(b.COOKIE_NAME,{path:this._cookiePath})},b.prototype.set=function(a,b){var c=this.sessionID,d=require("fs"),e=this._getSessionFileName(),f={cookiePath:this._cookiePath,data:this.data};if(!c)return;f.data||(f.data={}),f.data[a]=b,this.data=f.data,d.writeFile(e,JSON.stringify(f),function(a){})},b.prototype.get=function(a){var b=this.data;if(!b)return null;if(!a)return b;return b[a]},b.prototype.getID=function(){return this.sessionID},b.prototype._getSessionFileName=function(){return b.__sessionPath+"/"+this.sessionID},b._generateId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)}).toUpperCase()},exports.Session=b})()